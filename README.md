# kanata-tray

A simple wrapper for [kanata](https://github.com/jtroo/kanata) to control it from tray icon. 
Works on Windows and Linux.

## Features

- Tray icon with buttons for starting/stopping kanata
- Easy switching between multiple kanata configurations and versions.
- Customizable displayed tray icon when kanata changes layers.
- Works out-of-the box with no configuration, but can be configured with toml file.

## Configuration

Default config will be autogenerated for you on the first run. 
You can access it from from: `Click Tray Icon > Options`. 
On Linux, the config folder location is `~/.config/kanata-tray`. 
On Windows, it's `C:\Users\<YourUsername>\AppData\Roaming\kanata-tray`

An example of customized configuration file:

```toml
# default: []
configurations = [
    "~/.config/kanata/kanata.kbd",
    "~/.config/kanata/test.kbd",
]

# default: []
executables = [
    "~/.config/kanata/kanata", 
    "~/.config/kanata/kanata-debug",
]

[layer_icons]
base = "hello.ico" 
qwerty = "qwerty.ico"
"*" = "other_layers.ico"

[general]
include_executables_from_system_path = false # default: true
include_configs_from_default_locations = false # default: true
launch_on_start = true # default: true
tcp_port = 5829 # default: 5829
```

Notes:
- You can use `~` in paths to substitute to your "home" directory.
- `layer_icons` maps kanata layer names to custom icons. Custom icons should be placed in `icons` folder in config directory, next to `config.toml`. Accepted icon types on Linux are `.ico`, `.png`, `.jpg`; on Windows only `.ico` is supported. You can assign an icon to special identifier `"*"` to change icon for other layers not specified in `[layer_icons]`.
- On Windows, when providing paths, you need to replace every `\` character with `\\`. Example: `C:\\Users\\<User1\\Desktop\\kanata.kbd`.

Notes about autorun:
- If `configurations` is non-empty, the first item from it will be launched at start.
- Otherwise it falls back to a first kanata configs found by `include_configs_from_default_locations` option, if enabled.
- Otherwise, if no configs available, it won't auto-launch anything.
- Similar thing applies to kanata executables (see options `executables` and `include_executables_from_system_path`)

## Supported Kanata Versions

Minimal supported version of kanata is the release after `v1.5.0`.

More specifically, builds after commit [010338b](https://github.com/jtroo/kanata/commit/010338b14d0020098b9263a615ef2152c249d666) (because it fixed an issue with TCP server) 

## Linux Dependencies

For Linux, make sure to install required packages first:

### Arch:
```bash
pacman -S libayatana-appindicator
```

also if you want to build from source:
```bash
pacman -S base-devel gtk3 go just
``` 

### Ubuntu:
```bash
sudo apt-get install libayatana-appindicator3-dev 
```

also if you want to build from source:
```bash
sudo apt-get install gcc libgtk-3-dev golang just
```

### OpenSUSE Tumbleweed:
```bash
sudo zypper in libayatana-appindicator3-devel
```

## Installation

Prebuild binaries for Windows and Linux: [releases page](https://github.com/rszyma/kanata-tray/releases/latest)

To build from source see recipes in [justfile](./justfile).
